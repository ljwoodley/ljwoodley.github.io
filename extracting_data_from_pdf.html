<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Extracting Data From Web-Based PDF Files</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Laurence James-Woodley</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="Blog.html">BLOG</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/ljwoodley">
    <span class="fa fa-github fa-2x"></span>
     
  </a>
</li>
<li>
  <a href="https://www.linkedin.com/in/laurencejwoodley/">
    <span class="fa fa-linkedin fa-2x"></span>
     
  </a>
</li>
<li>
  <a href="mailto:laurencejwoodley@gmail.com">
    <span class="fas fa fas fa-envelope fa-2x"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Extracting Data From Web-Based PDF Files</h1>

</div>


<div class="figure">
<img src="https://resolutiontelevision.com/wp-content/uploads/2017/09/web-service-short-1024x556.jpg" />

</div>
<div id="introduction" class="section level3">
<h3>Introduction</h3>
<p>Many times there are multiple data sets that we’d like to download from a website. Sometimes we are fortunate enough that the data is stored in multiple csv files within a zipped folder or under a common link. But what if the data is not centrally stored in a single zipped file or is not in csv format? For this post we will extract data that is stored in multiple pdf files from the <a href="http://dos.myflorida.com/elections/data-statistics/elections-data/general-election-summaries/">Florida Division of Elections website</a>.</p>
</div>
<div id="pulling-the-data" class="section level3">
<h3>Pulling the data</h3>
<p>Let’s utilize the <code>html_nodes</code> and <code>html_attr</code> functions from the <code>rvest</code> package to extract all links from the webpage then zoom in on only the pdf documents.</p>
<pre class="r"><code>library(tidyverse)
library(knitr)
library(kableExtra)
library(rvest)
library(scales)
library(pdftools)

url &lt;- &quot;http://dos.myflorida.com/elections/data-statistics/elections-data/general-election-summaries/&quot;

#extract link names from page
links &lt;- read_html(url) %&gt;%
  html_nodes(&quot;a&quot;) %&gt;% 
  html_attr(&quot;href&quot;)

#detect pdf files we need
pdf_links &lt;- links[str_detect(links, &quot;.pdf&quot;)]
pdf_links</code></pre>
<pre><code>##  [1] &quot;/media/697842/2016-ge-summaries-ballots-by-type-activity.pdf&quot;   
##  [2] &quot;/media/697841/2016-ge-summaries-provisional-voting.pdf&quot;         
##  [3] &quot;/media/697839/2016-ge-summaries-poll-workers.pdf&quot;               
##  [4] &quot;/media/697840/2016-ge-summaries-precincts-and-polling-sites.pdf&quot;
##  [5] &quot;/media/694976/2014ballotscast.pdf&quot;                              
##  [6] &quot;/media/694977/2014provisionalballots.pdf&quot;                       
##  [7] &quot;/media/694978/2014pollworkers.pdf&quot;                              
##  [8] &quot;/media/694975/2014pollingsites.pdf&quot;                             
##  [9] &quot;/media/693340/2012ballotscast.pdf&quot;                              
## [10] &quot;/media/693345/2012provisionalballots.pdf&quot;                       
## [11] &quot;/media/693338/2012pollworkers.pdf&quot;                              
## [12] &quot;/media/693339/2012pollingsites.pdf&quot;                             
## [13] &quot;/media/693353/2010ballotscast.pdf&quot;                              
## [14] &quot;/media/693336/2010provisionalballots.pdf&quot;                       
## [15] &quot;/media/693337/2010pollworkers.pdf&quot;                              
## [16] &quot;/media/693355/2010pollingsites.pdf&quot;                             
## [17] &quot;/media/693351/2008ballotscast.pdf&quot;                              
## [18] &quot;/media/693354/2008provisionalballots.pdf&quot;                       
## [19] &quot;/media/693352/2008pollworkers.pdf&quot;                              
## [20] &quot;/media/693349/2008pollingsites.pdf&quot;                             
## [21] &quot;/media/693346/2006ballotscast.pdf&quot;                              
## [22] &quot;/media/693348/2006provisionalballots.pdf&quot;                       
## [23] &quot;/media/693350/2006pollworkers.pdf&quot;                              
## [24] &quot;/media/693347/2006pollingsites.pdf&quot;                             
## [25] &quot;/media/693341/2004ballotscast.pdf&quot;                              
## [26] &quot;/media/693836/2004provisionalballots.pdf&quot;                       
## [27] &quot;/media/693343/2004pollworkerinfo.pdf&quot;                           
## [28] &quot;/media/693342/2004pollingsites.pdf&quot;</code></pre>
<p>Based on the output we see that there are 28 unique links with the .pdf extension. Our main focus is the voter turnout data for the 2004 to 2016 general elections. This data is contained in the <code>ballotscast.pdf</code> for 2004 to 2014 and in <code>summaries-ballots-by-type-activity.pdf</code> for 2016. Now that we know which links contain the relevant data we can extract them using <code>str_detect</code>. Let’s use <em>ballotscast</em> and <em>type</em> as keywords for identifying the necessary pdf files.</p>
<pre class="r"><code>data_links &lt;- pdf_links[str_detect(pdf_links,&quot;ballotscast|type&quot;)]
data_links</code></pre>
<pre><code>## [1] &quot;/media/697842/2016-ge-summaries-ballots-by-type-activity.pdf&quot;
## [2] &quot;/media/694976/2014ballotscast.pdf&quot;                           
## [3] &quot;/media/693340/2012ballotscast.pdf&quot;                           
## [4] &quot;/media/693353/2010ballotscast.pdf&quot;                           
## [5] &quot;/media/693351/2008ballotscast.pdf&quot;                           
## [6] &quot;/media/693346/2006ballotscast.pdf&quot;                           
## [7] &quot;/media/693341/2004ballotscast.pdf&quot;</code></pre>
<p>Great! We are now left with seven links. Upon viewing all of the pdf files we see that each file has the data in the same sequence of columns. Thus it’s easy to create a function, <code>extract_data</code>, to extract the data from each pdf file and turn it into a dataframe. The logic follows:</p>
<ol style="list-style-type: decimal">
<li><p>Append the .pdf protion of each link to the base url and use <code>pdf_text</code> to read the lines of each file</p></li>
<li><p>Build a dataframe where each row corresponds to a line in the pdf file</p></li>
<li><p>Crete a regular expression that extracts any row that contains vote data. For example, <code>alachua 50,491 51,097 29,040 993</code>, is a row that contains vote data. We see that it’s the county name followed by four different vote counts. For data from 2004 to 2010 there would only be three vote counts as provisional data was not included for these years</p></li>
<li><p>Create regular expressions to extract the county and number of votes from each row. Additionally, we’ll extract the year from the <code>data_links</code> and append it to the dataframe</p></li>
<li><p>Use <code>map_df</code> to execute this function on each of the <code>data_links</code> and return a dataframe of vote data from all the years.</p></li>
</ol>
<pre class="r"><code>extract_data &lt;- function(data_links){
  
  txt_file &lt;- pdf_text(paste0(&quot;http://dos.myflorida.com&quot;, data_links))
  
  raw_txt &lt;- str_split(txt_file, &quot;\n&quot;) %&gt;% 
    unlist() %&gt;% 
    tibble() %&gt;%  
    rename(&quot;col1&quot; = &quot;.&quot;) %&gt;% 
    mutate_all(tolower) %&gt;%   
    mutate(col1 = str_squish(str_remove_all(col1, &quot;,&quot;)),
           vote_data = str_detect(col1, &quot;\\w+(\\s\\d+){3,4}&quot;))  %&gt;% 
    filter(vote_data == TRUE) %&gt;% 
    mutate(vote_count = str_extract(col1, &quot;(\\d+\\s){1,}\\d+&quot;),
           county = str_extract(col1, &quot;\\w+( |.)?( )?[[:alpha:]]+&quot;),
           year = str_extract(data_links, &quot;20\\d{2}&quot;))  %&gt;%  
    filter(!str_detect(county,&quot;total&quot;)) %&gt;%
    separate(vote_count, c(&quot;At Polls&quot;, &quot;Early&quot;, &quot;Absentee&quot;, &quot;provisional&quot;)) %&gt;%
    select(county,year, `At Polls`, Early, Absentee)
}

df &lt;- map_df(data_links, extract_data)

head(df)</code></pre>
<pre><code>## # A tibble: 6 x 5
##   county   year  `At Polls` Early  Absentee
##   &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;      &lt;chr&gt;  &lt;chr&gt;   
## 1 alachua  2016  50491      51097  29040   
## 2 baker    2016  3584       7180   2003    
## 3 bay      2016  25579      43963  18952   
## 4 bradford 2016  5095       4675   2450    
## 5 brevard  2016  109623     118427 92708   
## 6 broward  2016  213112     426592 202904</code></pre>
<p>Now let’s inspect the data to ensure it’s correct. There are 67 counties in Florida and we are extracting vote data for seven years. Thus, each county should appear exactly seven times in the dataframe.</p>
<pre class="r"><code>df %&gt;% 
  count(county) %&gt;% 
  filter(n != &#39;7&#39;)</code></pre>
<pre><code>## # A tibble: 2 x 2
##   county         n
##   &lt;chr&gt;      &lt;int&gt;
## 1 miami-dade     5
## 2 miami‐dade     2</code></pre>
<p>It appears that miami-dade has two different formattings. Let’s change this and recheck the data.</p>
<pre class="r"><code>df$county &lt;- str_replace(df$county, &quot;miami‐dade&quot;, &quot;miami-dade&quot;) 

df %&gt;% 
  count(county) %&gt;% 
  kable() %&gt;% 
  kable_styling() %&gt;% 
  scroll_box(height = &quot;400px&quot;)</code></pre>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:400px; ">
<table class="table" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
county
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
n
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
alachua
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
baker
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
bay
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
bradford
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
brevard
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
broward
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
calhoun
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
charlotte
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
citrus
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
clay
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
collier
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
columbia
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
desoto
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
dixie
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
duval
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
escambia
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
flagler
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
franklin
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
gadsden
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
gilchrist
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
glades
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
gulf
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
hamilton
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
hardee
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
hendry
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
hernando
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
highlands
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
hillsborough
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
holmes
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
indian river
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
jackson
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
jefferson
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
lafayette
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
lake
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
lee
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
leon
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
levy
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
liberty
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
madison
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
manatee
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
marion
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
martin
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
miami-dade
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
monroe
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
nassau
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
okaloosa
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
okeechobee
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
orange
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
osceola
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
palm beach
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
pasco
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
pinellas
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
polk
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
putnam
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
santa rosa
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
sarasota
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
seminole
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
st. johns
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
st. lucie
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
sumter
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
suwannee
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
taylor
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
union
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
volusia
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
wakulla
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
walton
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
washington
</td>
<td style="text-align:right;">
7
</td>
</tr>
</tbody>
</table>
</div>
<p><br />
<strong>Finally, the data is in a dataframe! Let’s pause for a round of applause.</strong></p>
<p> </p>
<center>
<img src="https://media.giphy.com/media/l3q2umc327t2nzSOQ/giphy.gif" />
</center>
</div>
<div id="data-visualization" class="section level3">
<h3>Data Visualization</h3>
<p>Let’s visualize the data to reveal any trends</p>
<pre class="r"><code>data &lt;- gather(df, vote_type, votes, 3:5, -c(1:2))

to_plot &lt;- data %&gt;% 
  group_by(year,vote_type) %&gt;% 
  summarise(total = sum(as.numeric(votes))) %&gt;% 
  mutate(percentage = total/sum(total))

to_plot$year &lt;- factor(to_plot$year, levels = c(&quot;2004&quot;,&quot;2006&quot;,&quot;2008&quot;,&quot;2010&quot;,&quot;2012&quot;,&quot;2014&quot;,&quot;2016&quot;))

ggplot(to_plot, aes(x = year, y = total, fill = vote_type))+
  geom_col()+
  labs(x = &#39;Year&#39;,y = &#39;Total Voters&#39;, title = &#39;Florida\&#39;s\ Yearly Voter Turnout\n (2004 - 2016)&#39;,
       fill = &#39;Vote Method&#39;)+
  scale_y_continuous(labels = comma)+
  geom_text(aes(label = paste0(round(percentage*100),&quot;%&quot;)), position = position_stack(vjust = 0.5))+
  scale_fill_brewer(palette = &quot;Dark2&quot;)+
  theme_minimal()+
  theme(plot.title = element_text(hjust = 0.5),
        text = element_text(size = 15))</code></pre>
<p><img src="extracting_data_from_pdf_files/figure-html/unnamed-chunk-6-1.png" width="1152" /></p>
<p>Based on the above chart we observe a few things:</p>
<ul>
<li><p>The turnout for years 2004, 2008, 2012 and 2016 is higher than the other years. This is because these were presidential election years and people are more likely to vote in a presidential election than in a midterm general election.</p></li>
<li><p>There is an upward trend to the data, especially for presidential election years. The turnout in 2016 was almost 10,000,000.</p></li>
<li><p>Election day voting has been decreasing for each of the presidential and midterm elections. In 2004, 64% of voters voted on election day but only 31% of voters voted on election day in 2016. This is about a 50% drop in election day voting.</p></li>
<li><p>Early voting accounted for 40% of all voters in 2016 compared to 28% in 2012. The 2016 presidential election was somewhat of a political storm and turnout was expected to be significantly higher than usual. As a result, a larger portion of people may have chosen early voting to avoid the hassle of voting on election day.</p></li>
</ul>
</div>
<div id="conclusion" class="section level3">
<h3>Conclusion</h3>
<p>At times the data needed for analysis is not readily available. As data analysts, data scientists, and sometimes statisticians it is part of our jobs to be equipped with the skills needed to extract and tidy data in both structured and unstructured format. This post provided a brief introduction on how we can extract structured data from web-based files, tidy and then visualize the data to gain insights.</p>
<hr />
<p>An interactive chart was created to allow the user to view the turnout within a specific county and can be found <a href="https://laurencejames.shinyapps.io/CountyTurnout/">here</a></p>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
